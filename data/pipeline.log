/Users/abigailhaddad/Documents/repos/regs/myenv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
2025-05-27 01:21:25,661 - INFO - HTTP Request: GET https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json "HTTP/1.1 200 OK"
2025-05-27 01:21:26,024 - INFO - üöÄ Starting resume-aware pipeline...
2025-05-27 01:21:26,024 - INFO - üìÅ CSV file: comments.csv
2025-05-27 01:21:26,024 - INFO - üìÅ Input raw data: data/raw_data.json
2025-05-27 01:21:26,024 - INFO - üìÅ Input lookup table: data/lookup_table_corrected.json
2025-05-27 01:21:26,024 - INFO - üìÅ Output directory: results/results_20250527_012123
2025-05-27 01:21:26,024 - INFO - 
üìä Initial data check:
2025-05-27 01:21:26,141 - INFO -    Existing raw_data.json: 21,536 comments
2025-05-27 01:21:26,189 - INFO -    Existing lookup table: 15,674 entries
2025-05-27 01:21:26,189 - INFO - üîç Validating truncation consistency...
2025-05-27 01:21:26,283 - INFO - ‚úÖ No truncation needed (existing max: 0 chars)
2025-05-27 01:21:26,288 - INFO - üìñ Loading comment IDs from CSV: comments.csv
2025-05-27 01:21:26,543 - INFO - ‚úÖ Found 21,548 comment IDs in CSV
2025-05-27 01:21:26,543 - INFO - üìñ Loading comment IDs from raw_data: data/raw_data.json
2025-05-27 01:21:26,655 - INFO - ‚úÖ Found 21,536 comment IDs in raw_data
2025-05-27 01:21:26,665 - INFO - üìä Comment ID analysis:
2025-05-27 01:21:26,665 - INFO -    CSV file: 21,548 comments
2025-05-27 01:21:26,665 - INFO -    Raw data: 21,536 comments
2025-05-27 01:21:26,665 - INFO -    New to fetch: 12 comments
2025-05-27 01:21:26,667 - INFO - 
=== Preparing output directory ===
2025-05-27 01:21:26,679 - INFO - ‚úÖ Copied raw_data.json to output directory
2025-05-27 01:21:26,684 - INFO - ‚úÖ Copied lookup table to output directory
2025-05-27 01:21:26,684 - INFO - 
=== STEP 1: Fetching 12 New Comments ===
2025-05-27 01:21:26,684 - INFO - üîÑ Fetching 12 new comments with attachments...
/Users/abigailhaddad/Documents/repos/regs/backend/resume_pipeline.py:177: DtypeWarning: Columns (7,10,11,21,30,38,56,57) have mixed types. Specify dtype option on import or set low_memory=False.
  df = pd.read_csv(csv_file, on_bad_lines='skip')
2025-05-27 01:21:26,879 - INFO - üìä Filtering CSV:
2025-05-27 01:21:26,879 - INFO -    Total rows in CSV: 21548
2025-05-27 01:21:26,880 - INFO -    Using column: Document ID
2025-05-27 01:21:26,880 - INFO -    New comment IDs to find: 12
2025-05-27 01:21:26,880 - INFO -    Matching rows found: 12
2025-05-27 01:21:26,881 - INFO - Fetching comments from filtered CSV...
2025-05-27 01:21:26,996 - INFO - Loaded 21,536 existing comments from results/results_20250527_012123/raw_data.json
2025-05-27 01:21:27,260 - INFO - ‚úÖ Appended 11 new comments to raw_data
2025-05-27 01:21:27,260 - INFO - ‚úÖ Total comments in raw_data: 21,547
2025-05-27 01:21:27,271 - INFO - 
=== STEP 2: Updating Lookup Table ===
2025-05-27 01:21:27,319 - INFO -    Starting with 15674 existing entries
2025-05-27 01:21:27,437 - INFO -    Processing 11 new comments
2025-05-27 01:21:27,762 - INFO -    Added to existing entries: 0
2025-05-27 01:21:27,762 - INFO -    New entries created: 11
2025-05-27 01:21:27,929 - INFO - ‚úÖ Lookup table saved with 15685 entries
2025-05-27 01:21:27,934 - INFO -    Including 11 entries with new comments
2025-05-27 01:21:27,987 - INFO - 
=== STEP 3: LLM Analysis (11 entries) ===
2025-05-27 01:21:28,085 - INFO - Starting analysis of 15685 lookup entries
2025-05-27 01:21:28,085 - INFO - Already analyzed: 15674
2025-05-27 01:21:28,085 - INFO - Remaining to analyze: 11
2025-05-27 01:21:28,086 - INFO - Processing batch 3135: entries 15671-15675 (1 unanalyzed)
[92m01:21:28 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:28,091 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:30,489 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:30 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:30,508 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:30 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:30,508 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:30 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:30,510 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:30 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:30,510 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:30,511 - INFO - Processing batch 3136: entries 15676-15680 (5 unanalyzed)
[92m01:21:30 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:30,513 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:30 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:30,517 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:30 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:30,520 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:30 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:30,523 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:30 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:30,526 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:32,639 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:32 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:32,647 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:32 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:32,648 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:32 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:32,650 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:32,922 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:32 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:32,925 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:32 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:32,926 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:32 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:32,927 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:33,456 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:33 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:33,460 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:33 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:33,461 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:33 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:33,463 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:33,465 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:33 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:33,471 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:33 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:33,472 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:33 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:33,473 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:34,379 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:34 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:34,383 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:34 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:34,383 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:34 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:34,385 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:34,386 - INFO - Processing batch 3137: entries 15681-15685 (5 unanalyzed)
[92m01:21:34 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:34,390 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:34 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:34,396 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:34 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:34,398 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:34 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:34,399 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
[92m01:21:34 - LiteLLM:INFO[0m: utils.py:2904 - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:34,401 - INFO - 
LiteLLM completion() model= gpt-4o-mini; provider = openai
2025-05-27 01:21:37,450 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-27 01:21:37,452 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:37 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:37,455 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,455 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,457 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:37 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:37,459 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,459 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,460 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,763 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:37 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:37,767 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,767 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,769 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,863 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:37 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:37,867 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,867 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,869 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,871 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[92m01:21:37 - LiteLLM:INFO[0m: utils.py:1211 - Wrapper: Completed Call, calling success_handler
2025-05-27 01:21:37,873 - INFO - Wrapper: Completed Call, calling success_handler
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,873 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
[92m01:21:37 - LiteLLM:INFO[0m: cost_calculator.py:655 - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:37,875 - INFO - selected model name for cost calculation: openai/gpt-4o-mini-2024-07-18
2025-05-27 01:21:38,083 - INFO - Checkpoint saved to results/results_20250527_012123/lookup_table_corrected.json.checkpoint
2025-05-27 01:21:38,084 - INFO - Analysis complete! 15685/15685 entries analyzed
2025-05-27 01:21:38,247 - INFO - ‚úÖ Analysis complete, saved to results/results_20250527_012123/lookup_table_corrected_analyzed.json
2025-05-27 01:21:38,247 - INFO - 
=== STEP 4: Semantic Clustering ===
2025-05-27 01:21:38,302 - INFO - Clustering 15685 entries into 15 clusters
2025-05-27 01:28:36,611 - INFO - ‚úÖ Clustering complete
2025-05-27 01:28:36,614 - INFO - üöÄ Starting semantic clustering on deduplicated lookup table...
üìÅ Input: results/results_20250527_012123/lookup_table_corrected_analyzed.json
üìÅ Output: results/results_20250527_012123/clustering_20250527_012142
üéØ Number of clusters: 15
üìñ Loading analyzed lookup table from results/results_20250527_012123/lookup_table_corrected_analyzed.json...
‚úÖ Loaded 15,685 lookup entries
‚úÖ Processed 15,684 entries with valid text
üìä Analysis status:
   Analyzed entries: 15,684/15,684 (100.0%)
   Total comments represented: 21,546
üìä Stance distribution:
   Against: 19,847 (92.1%)
   For: 1,484 (6.9%)
   Neutral/Unclear: 215 (1.0%)
ü§ñ Loading model: sentence-transformers/all-mpnet-base-v2
üîÑ Creating embeddings for 15,684 unique texts...
‚úÖ Created embeddings with shape: (15684, 768)
üå≥ Performing hierarchical clustering with 15 clusters...
‚úÖ Clustering complete. Cluster distribution:
  Cluster 0: 1,159 unique texts (7.4%)
  Cluster 1: 458 unique texts (2.9%)
  Cluster 2: 1,765 unique texts (11.3%)
  Cluster 3: 1,134 unique texts (7.2%)
  Cluster 4: 1,410 unique texts (9.0%)
  Cluster 5: 816 unique texts (5.2%)
  Cluster 6: 957 unique texts (6.1%)
  Cluster 7: 1,016 unique texts (6.5%)
  Cluster 8: 1,028 unique texts (6.6%)
  Cluster 9: 1,169 unique texts (7.5%)
  Cluster 10: 904 unique texts (5.8%)
  Cluster 11: 2,134 unique texts (13.6%)
  Cluster 12: 711 unique texts (4.5%)
  Cluster 13: 624 unique texts (4.0%)
  Cluster 14: 399 unique texts (2.5%)
üìä Analyzing cluster contents and stance disagreements...
üìä Creating visualizations...
  Creating PCA visualization...
‚úÖ Visualizations saved to: results/results_20250527_012123/clustering_20250527_012142
üìù Creating cluster report...
‚úÖ Report saved to: results/results_20250527_012123/clustering_20250527_012142/cluster_report.txt
‚úÖ Updated 15684 entries with cluster IDs and PCA coordinates
‚úÖ Clustered lookup table saved to results/results_20250527_012123/lookup_table_corrected_analyzed_clustered.json

‚úÖ Clustering complete!
üìä 15,684 unique texts clustered into 15 clusters
üìä Representing 21,546 total comments
üöÄ Efficiency: Clustered 15,684 texts instead of 21,546 comments
‚ö° Speed improvement: ~1.4x faster
üìÅ Output files:
   - results/results_20250527_012123/clustering_20250527_012142/dendrogram.png
   - results/results_20250527_012123/clustering_20250527_012142/clusters_visualization.png
   - results/results_20250527_012123/clustering_20250527_012142/cluster_report.txt
   - results/results_20250527_012123/lookup_table_corrected_analyzed_clustered.json

2025-05-27 01:28:36,615 - INFO - 
=== STEP 5: Skipping Quote Verification ===
2025-05-27 01:28:36,615 - INFO - 
üéâ Resume pipeline complete!
Reading comments from CSV file: results/results_20250527_012123/new_comments_temp.csv
Saved 11 comments to results/results_20250527_012123/temp_fetch/raw_data.json
